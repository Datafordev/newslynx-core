$schema: "http://json-schema.org/draft-04/schema#"
title: NewsLynx SousChef Schema
type: object
required: 
    - name
    - slug
    - description
    - runs
    - creates
    - options

properties:
    name:
       description: The display name of this sous-chef
       type: string

    slug:
       description: A slug to display this task in a url.
       type: string
       pattern: '^[a-z][a-z\-]+[a-z]$'

    description:
        description: A description of the purpose this sous-chef serves
        type: string
    
    runs:
        description: |
            Either an absolute path to an executable script, or a python module which inherits 
            from core newslynx.sc.SousChef class. If an executable, it must be accessible 
            by the machine that runs the sous chef.
        type: string
    
    creates:
        description: "What does this sous-chef create? Can be event, thing, tag, metric, series."
        enum:
            - events
            - content
            - tags
            - metrics
            - report
            - external
            - internal

    options:
        description: Options this sous-chef accepts.
        patternProperties: 
            '^[a-z][a-z_]+[a-z]$': 
                $ref: "#/definitions/option_item"

    metrics: 
        description: Metrics this sous-chef creates.
        patternProperties: 
            '^[a-z][a-z_]+[a-z]$':
                $ref: "#/definitions/metric_item"            

definitions:
    metric_item:
        description: A metric the sous-chef creates.
        type: object
        required:
            - display_name
            - level 
            - aggregation
        properties:
            
            display_name:
                type: string
            
            level:
                type: string 
                enum:
                    - content_item
                    - org 
                    - all 
            aggregation:
                type: string 
                enum:
                    - median
                    - avg
                    - min
                    - max
                    - sum

            cumulative:
                type: boolean
                default: false 

            faceted:
                type: boolean
                default: false 

            timeseries:
                type: boolean
                default: false

    option_item:
        description: An option for the sous-chef 
        type: object
        required: 
            - input_type 
            - value_types
        properties:
            input_type:
                description: What type of input form should this option render?
                type: string
                enum:
                    - radio
                    - select
                    - checkbox
                    - number
                    - datepicker
                    - text
                    - paragraph

            input_options:
                description: |
                    If the input_type is radio, select, or checkbox, a list of possible
                    options to populate the dropdown.
                type: array
                minItems: 1
                items:
                    type:
                        - string
                        - number 
                        - boolean 
                uniqueItems: true

            value_types:
                description: What data type(s) does this option accept?
                type: array
                minItems: 1 
                items:
                    type: string 
                    enum:
                        - datetime
                        - regex
                        - boolean
                        - numeric
                        - string
                        - nulltype
                        - url
                        - email
                        - searchstring

            accepts_list:
                description: Can this option accept multiple values?
                type: boolean
                default: false

            default:
                description: What is the default value for this option?
                type:
                    - string
                    - number
                    - boolean
                    - 'null'
                    - array
            
            required:
                description: Is this option required?
                type: boolean
            
            help:
                description: Placehold / help reference for this option.
                type: object
                properties:
                    placeholder:
                        description: The placeholder/example text for this option.
                        type:
                            - string
                            - number
                            - boolean
                    link:
                        description: A link for more details about this option.
                        type: string
                    
                    description:
                        description: A description of this option to display on form hover.
                        type: string
